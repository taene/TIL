## 학습 키워드
- Unreal Engine
- Mass Framework
- ECS (Entity Component System)
- Data-Oriented Design
- MassEntity
- Fragment
- Processor
- Archetype

## 학습 내용
### 배운 개념 요약
전통적인 언리얼 엔진의 `AActor`는 게임 오브젝트를 표현하는 강력한 수단이지만, 하나의 객체에 너무 많은 기능(트랜스폼, 렌더링, 로직 등)이 통합되어 있어 대규모 시뮬레이션에는 부적합하다. 수천, 수만 개의 액터를 동시에 처리할 경우 메모리 오버헤드와 CPU 캐시 미스로 인해 심각한 성능 저하가 발생한다.

이러한 문제를 해결하기 위해 언리얼 엔진은 데이터 지향 기술 스택(DOTS)의 일부인 **Mass 프레임워크**를 도입했다. 이는 ECS(Entity Component System) 패턴을 기반으로 하며, 데이터와 로직을 철저히 분리하여 성능을 극대화하는 것을 목표로 한다.

-   **MassEntity**: 본질적으로 정수 ID(`FMassEntityHandle`)에 불과한 경량 식별자이다. 자체적으로는 어떠한 데이터나 기능도 가지지 않으며, 특정 개체를 가리키는 역할만 수행한다.

-   **Fragment**: 엔티티가 가질 수 있는 순수한 데이터 조각(`FMassFragment`를 상속하는 `USTRUCT`)이다. 위치, 체력, 속도 등 개체의 상태를 나타내는 데이터만 담으며, 어떠한 로직도 포함하지 않는다.

-   **Archetype**: 동일한 프래그먼트 조합을 가진 엔티티들의 묶음이다. Mass는 같은 아키타입에 속한 엔티티들의 프래그먼트 데이터를 메모리 상에 연속적으로 배치하여 데이터 접근성을 최적화한다.

-   **Processor**: 실제 로직을 수행하는 주체(`UMassProcessor`)이다. 특정 프래그먼트 조합을 가진 엔티티들을 쿼리(Query)한 후, 아키타입을 통해 효율적으로 데이터에 접근하여 한 번에 일괄 처리(Batch Processing)한다. 이 과정에서 CPU 캐시 효율이 극대화되어 폭발적인 성능 향상을 이끌어낸다.

결론적으로, 복잡하고 고유한 소수의 '영웅' 오브젝트는 기존의 `AActor`와 GAS를 사용하고, 단순하고 수가 많은 다수의 '군중' 오브젝트는 Mass 프레임워크를 사용하는 것이 현대적인 AAA 게임 개발의 핵심적인 하이브리드 접근법이다.

<br/>

### 구현 과정
Mass 프레임워크의 개념적 구현 과정은 다음과 같은 단계로 이루어진다.

1.  **데이터 정의 (Fragments)**: 게임에 필요한 데이터 단위를 `FMassFragment`를 상속하는 구조체로 정의한다. 예를 들어, `FHealthFragment`에는 현재 체력과 최대 체력 변수를, `FMovementFragment`에는 목표 위치와 이동 속도 변수를 선언한다.

2.  **로직 구현 (Processors)**: `UMassProcessor`를 상속하는 클래스를 만들고, 처리할 프래그먼트 조합을 지정하는 쿼리를 작성한다. 예를 들어, `MovementProcessor`는 `FTransformFragment`와 `FMovementFragment`를 모두 가진 엔티티를 대상으로 쿼리를 실행하도록 설정한다.

3.  **데이터 처리**: Processor의 `Execute` 함수 내에서 쿼리된 엔티티들의 데이터에 접근하여 로직을 수행한다. `FMassExecutionContext`를 통해 각 엔티티의 프래그먼트 데이터에 대한 포인터를 얻고, 이를 수정하여 개체의 상태를 변화시킨다.

4.  **엔티티 생성**: `UMassEntitySubsystem`을 사용하여 엔티티를 생성하고, 필요한 프래그먼트들을 추가하여 원하는 아키타입에 할당한다. 이를 통해 월드에 Mass 개체를 스폰한다.

<br/>

## 느낀점
객체 지향 프로그래밍(OOP)에 익숙했던 관점에서 데이터 지향 설계(DOD)는 상당히 새로운 접근 방식이었다. 모든 것을 하나의 클래스(객체)에 캡슐화하려는 시도에서 벗어나, 데이터와 로직을 분리하고 데이터 자체의 배치와 흐름을 최적화하는 것이 왜 대규모 연산에서 중요한지를 명확히 이해하게 되었다.

특히 'CPU 캐시 효율성'이라는 하드웨어적 관점이 게임 성능에 얼마나 직접적인 영향을 미치는지 깨달았다. Mass 프레임워크는 단순히 코드를 다르게 짜는 수준이 아니라, 하드웨어가 가장 효율적으로 일할 수 있는 환경을 만들어주는 설계 철학이라는 점이 인상 깊었다.

라이라(Lyra)와 같은 프로젝트에서 '영웅' 캐릭터는 액터로, 수많은 AI는 Mass로 처리할 수 있다는 하이브리드 접근법은 매우 실용적이다. 모든 것을 하나의 패러다임으로 해결하려는 것이 아니라, 문제의 성격에 따라 가장 적합한 도구를 선택하는 것이 뛰어난 아키텍처의 핵심임을 다시 한번 확인했다. 앞으로 대규모 콘텐츠를 기획하고 구현할 때 반드시 고려해야 할 필수적인 무기를 얻은 기분이다.
