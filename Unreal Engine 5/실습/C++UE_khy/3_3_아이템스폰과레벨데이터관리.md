## 학습 키워드

  - 스폰 볼륨 (Spawn Volume)
  - 데이터 테이블 (Data Table)
  - `FTableRowBase`
  - CSV 임포트
  - 가중치 랜덤 (Weighted Random)

<br/>

## 학습 내용

### 배운 개념 요약

  - **스폰 볼륨 (Spawn Volume)**

      - 아이템을 생성할 특정 영역을 정의하기 위한 액터다.
      - 일반적으로 `UBoxComponent` 같은 콜리전 컴포넌트를 사용하여 사각형의 스폰 범위를 지정하고, 이 범위 내의 랜덤한 위치를 계산하는 데 사용된다.

  - **데이터 테이블 (Data Table)**

      - 아이템 스폰 확률과 같은 게임 데이터를 코드와 분리하여 외부 파일(CSV, JSON)이나 에디터에서 직접 관리할 수 있게 해주는 강력한 기능이다.
      - 기획자나 디자이너가 빌드 없이 엑셀 파일만 수정하여 게임 밸런스를 조절할 수 있어 협업에 매우 유용하다.
      - 데이터 테이블을 사용하려면, 먼저 C++에서 `FTableRowBase`를 상속받는 구조체(`USTRUCT`)를 정의하여 테이블의 각 행(Row)이 어떤 데이터로 구성될지 명시해야 한다.

<br/>


### 구현 과정

1.  **`ASpawnVolume` 클래스 생성**

      - `AActor`를 상속받는 `ASpawnVolume` 클래스를 생성한다.
      - 내부에 스폰 영역을 정의할 `UBoxComponent`를 추가한다.
      - `GetRandomPointInVolume` 함수를 구현하여, `SpawningBox`의 중심 위치와 크기(`GetScaledBoxExtent`)를 기반으로 `FMath::FRandRange`를 사용해 박스 내의 랜덤한 좌표를 반환하도록 한다.

2.  **데이터 테이블용 구조체 생성**

      - 데이터 테이블의 행 구조를 정의하기 위해 `FTableRowBase`를 상속받는 `FItemSpawnRow` 구조체를 C++로 생성한다.
      - 구조체 내부에는 스폰할 아이템 클래스(`TSubclassOf<AActor>`), 스폰 확률(`SpawnChance`) 등의 `UPROPERTY`를 선언한다.

3.  **데이터 테이블 생성 및 임포트**

      - **방법 1 (CSV)**: 엑셀 등에서 아이템 정보와 스폰 확률을 담은 CSV 파일을 작성한다. 이때 각 아이템 블루프린트의 경로는 에디터에서 `Copy Reference`를 통해 얻을 수 있다. 작성한 CSV 파일을 언리얼 에디터로 임포트하면서 행 타입(Row Type)으로 앞서 만든 `FItemSpawnRow` 구조체를 선택한다.
      - **방법 2 (에디터)**: 콘텐츠 브라우저에서 `Miscellaneous > Data Table`을 선택하고 `FItemSpawnRow`를 행 구조체로 지정하여 데이터 테이블 에셋을 직접 생성하고 편집할 수 있다.

4.  **가중치 랜덤 스폰 로직 구현**

      - `ASpawnVolume` 클래스에 생성한 데이터 테이블을 가리키는 `UDataTable*` 포인터 변수를 추가한다.
      - 가중치 랜덤 로직을 구현하는 `GetRandomItem` 함수를 만든다.
        1.  데이터 테이블의 모든 행(Row)을 가져온다.
        2.  모든 아이템의 `SpawnChance`를 더해 전체 확률의 합(`TotalChance`)을 구한다.
        3.  0부터 `TotalChance` 사이의 랜덤한 숫자 하나를 뽑는다.
        4.  아이템들을 순회하며 확률을 누적하다가, 누적된 확률값이 랜덤 숫자를 처음으로 넘어설 때의 아이템을 최종 선택하여 반환한다.

5.  **블루프린트에서 실행**

      - `ASpawnVolume`을 상속받는 `BP_SpawnVolume` 블루프린트를 만들고 레벨에 배치한다.
      - `BP_SpawnVolume`의 디테일 패널에서 C++에 선언한 `ItemDataTable` 변수에 생성해둔 데이터 테이블 에셋을 할당한다.
      - `BeginPlay` 이벤트에서 `For Loop` 노드를 사용하여 C++로 구현한 `SpawnRandomItem` 함수를 여러 번 호출하여 랜덤 스폰을 테스트한다.

<br/>


## 느낀점

  - 게임 데이터를 코드에서 분리하는 것이 왜 중요한지 명확히 알게 되었다. 아이템 스폰 확률을 데이터 테이블로 관리하니, C++ 코드를 전혀 건드리지 않고 CSV 파일 수정만으로 게임의 난이도와 밸런스를 쉽게 조절할 수 있었다. 이는 개발 효율성과 유지보수 측면에서 엄청난 이점이다.
  - 가중치 랜덤 로직은 다양한 확률 기반 시스템(아이템 드랍, 가챠 등)에 공통으로 사용할 수 있는 핵심 알고리즘이다. 전체 확률의 합을 구하고 랜덤 값을 뽑아 구간별로 비교하는 방식은 꼭 기억해둬야겠다.
  - 레벨별로 다른 데이터 테이블 에셋을 지정하는 방식은 매우 직관적이고 관리하기 편하다. 복잡한 필터링 로직 없이, 각 레벨에 맞는 데이터 에셋을 할당하는 것만으로 다른 경험을 제공할 수 있다는 점이 마음에 든다.

-----

### 요약

- 아이템 랜덤 스폰은 `UBoxComponent`를 가진 **스폰 볼륨** 액터를 만들어 특정 영역 내에 아이템을 생성하는 방식으로 구현한다.
- 스폰될 아이템의 종류와 확률은 코드와 분리된 **데이터 테이블**로 관리하며, 이는 `FTableRowBase`를 상속받는 C++ 구조체와 CSV 파일을 통해 정의된다.
- C++ 코드에서는 데이터 테이블을 읽어 모든 아이템의 확률 총합을 구하고, 그 범위 내에서 랜덤 값을 뽑아 **가중치 랜덤** 방식으로 스폰할 아이템을 결정한다. 이 구조는 게임 밸런스 조절과 유지보수를 매우 용이하게 만든다.
