## 학습 키워드

  - 파티클 시스템 (Particle System)
  - 나이아가라 (Niagara) / 캐스케이드 (Cascade)
  - 사운드 큐 (Sound Cue) / 사운드 웨이브 (Sound Wave)
  - `SpawnEmitterAtLocation`
  - `PlaySoundAtLocation`
  - 비동기적 소멸 (Asynchronous Destruction) / `TWeakObjectPtr`

<br/>


## 학습 내용

### 배운 개념 요약

  - **파티클 시스템 (Particle System)**

      - 게임 월드 내에서 폭발, 연기, 마법 효과 등 다양한 시각 효과(VFX)를 만드는 데 사용되는 시스템이다. 다수의 작은 입자(Particle)를 방출하여 움직임을 제어함으로써 화려한 연출을 구현한다.
      - 언리얼 엔진에는 두 가지 주요 파티클 시스템이 있다:
          - **캐스케이드 (Cascade)**: 오래된 레거시 시스템으로, 구조가 비교적 간단하여 초급자가 빠르게 결과를 보기 좋다.
          - **나이아가라 (Niagara)**: UE4 후반부터 도입된 차세대 시스템으로, 모듈화된 구조와 높은 자유도를 통해 훨씬 정교하고 복잡한 VFX 제작이 가능하다. UE5에서는 공식적으로 권장되는 방식이다.

  - **사운드 시스템**

      - 언리얼 엔진의 사운드는 크게 두 가지 에셋으로 관리된다:
          - **사운드 웨이브 (Sound Wave)**: `.wav`와 같은 단일 오디오 파일 자체를 의미한다. 가장 기본적인 사운드 데이터다.
          - **사운드 큐 (Sound Cue)**: 여러 사운드 웨이브를 조합하거나, 재생 방식(랜덤, 순차), 볼륨, 피치 등을 노드 기반 그래프로 편집하여 복합적인 사운드를 디자인하는 에셋이다.

  - **C++을 통한 이펙트 재생**

      - **`UGameplayStatics::SpawnEmitterAtLocation`**: 지정된 위치에 파티클 이펙트를 생성하는 스태틱 함수다. 이펙트 재생에 가장 보편적으로 사용된다.
      - **`UGameplayStatics::PlaySoundAtLocation`**: 지정된 위치에 사운드(사운드 웨이브 또는 사운드 큐)를 재생하는 스태틱 함수다.

  - **비동기적 소멸 처리**

      - 아이템이 획득되어 사라진 후에도 파티클 이펙트는 잠시 동안 화면에 남아있어야 자연스럽다.
      - 이를 구현하기 위해 아이템 소멸과 파티클 소멸을 분리해야 한다. `GetWorld()->GetTimerManager().SetTimer()`를 사용하여 일정 시간 뒤에 파티클 컴포넌트를 파괴하도록 예약할 수 있다.
      - 이때, 타이머가 실행되기 전에 파티클이 다른 이유로 먼저 사라질 경우를 대비해, 일반 포인터 대신 **`TWeakObjectPtr`**를 사용하여 안전하게 참조하는 것이 좋다. `TWeakObjectPtr`는 참조하는 오브젝트가 소멸되면 자동으로 `nullptr`처럼 동작하여 유효성 검사(`IsValid()`)를 통해 크래시를 방지할 수 있다.

<br/>

### 구현 과정

#### 1. `ABaseItem`에 공통 이펙트 기능 추가

1.  **헤더 파일 수정**: `ABaseItem.h`에 아이템 획득 시 재생할 파티클과 사운드를 담을 `UPROPERTY`를 추가한다. `EditAnywhere`로 지정하여 블루프린트에서 에셋을 할당할 수 있게 한다.

    ```cpp
    // BaseItem.h
    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Item | Effects")
    UParticleSystem* PickupParticle;

    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Item | Effects")
    USoundBase* PickupSound;
    ```

2.  **`ActivateItem` 함수 수정**: `ABaseItem::ActivateItem` 함수 내부에 파티클과 사운드를 재생하는 로직을 추가한다.

      - `UGameplayStatics::SpawnEmitterAtLocation`으로 `PickupParticle`을 스폰한다.
      - `UGameplayStatics::PlaySoundAtLocation`으로 `PickupSound`를 재생한다.
      - `SetTimer`와 람다 함수, `TWeakObjectPtr`를 사용하여 스폰된 파티클이 2초 뒤에 안전하게 사라지도록 예약한다.

#### 2. `AMineItem`에 전용 폭발 이펙트 추가

1.  **헤더 파일 수정**: `AMineItem.h`에 획득 효과와는 별개로, 폭발 시 사용할 `ExplosionParticle`과 `ExplosionSound`를 위한 `UPROPERTY`를 추가한다.
2.  **`Explode` 함수 수정**: 타이머에 의해 호출되는 `AMineItem::Explode` 함수 내부에, `SpawnEmitterAtLocation`과 `PlaySoundAtLocation`을 사용하여 폭발 파티클과 사운드를 재생하는 로직을 추가한다.
3.  **중복 발동 방지**: 지뢰가 여러 번 발동되는 것을 막기 위해 `bHasExploded`와 같은 bool 플래그 변수를 사용하여 `ActivateItem` 함수가 한 번만 실행되도록 제어한다.

#### 3. 블루프린트에서 이펙트 에셋 할당

1.  **컴파일**: 수정된 C++ 코드를 컴파일한다.
2.  **에셋 할당**: 각 아이템 블루프린트(예: `BP_CoinItem`, `BP_MineItem`)를 열고 `Details` 패널을 확인한다.
3.  C++에서 `UPROPERTY`로 선언한 `Pickup Particle`, `Pickup Sound`, `Explosion Particle` 등의 속성이 노출되어 있는 것을 볼 수 있다.
4.  각 항목에 콘텐츠 브라우저에 있는 파티클 에셋과 사운드 에셋을 드래그 앤 드롭하여 할당한다.

<br/>


## 느낀점

  - 단순히 아이템이 사라지는 것보다 파티클과 사운드가 추가되니 게임의 피드백이 훨씬 명확해지고 플레이하는 재미가 배가되었다. 시청각적 효과가 게임의 완성도와 몰입감에 얼마나 큰 영향을 미치는지 다시 한번 체감했다.
  - C++에서 기능의 '틀'(`UPROPERTY` 포인터)을 제공하고, 실제 내용물(파티클, 사운드 에셋)은 블루프린트에서 채워 넣는 언리얼의 개발 방식이 매우 효율적이라고 느꼈다. 이 구조 덕분에 프로그래머는 로직에 집중하고, 아티스트는 코드 수정 없이 자유롭게 이펙트를 교체하며 테스트할 수 있다.
  - 아이템 소멸 후에도 이펙트가 남아있도록 처리하는 비동기적 로직은 실무에서 매우 중요할 것 같다. `TWeakObjectPtr`와 타이머를 조합한 안전한 메모리 관리 기법은 예측 불가능한 상황에서 발생할 수 있는 크래시를 예방하는 좋은 습관이 될 것이다.

-----

### 요약

- 게임의 시청각 효과는 **파티클 시스템**(Cascade, Niagara)과 **사운드**(Sound Wave, Sound Cue)를 통해 구현한다.
- C++ 코드에서는 `UPROPERTY`를 이용해 파티클과 사운드 에셋을 담을 변수를 노출시킨 뒤, `UGameplayStatics::SpawnEmitterAtLocation`과 `UGameplayStatics::PlaySoundAtLocation` 함수를 호출하여 이펙트를 재생한다.
- 아이템 소멸 후에도 이펙트를 잠시 유지하기 위해 `SetTimer`를 사용하며, 이때 `TWeakObjectPtr`를 활용하면 파티클 컴포넌트를 안전하게 참조하고 소멸시킬 수 있다.
