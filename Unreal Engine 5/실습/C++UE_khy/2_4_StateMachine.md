## 학습 키워드

  - 애니메이션 블루프린트 (Animation Blueprint)
  - 스테이트 머신 (State Machine)
  - 이벤트 그래프 (Event Graph) / 애님 그래프 (Anim Graph)
  - 블렌드 스페이스 (Blend Space)
  - 캐시된 포즈 (Cached Pose)
  - 스테이트 별칭 (State Alias)

<br/>

## 학습 내용

### 배운 개념 요약

  - **애니메이션 블루프린트 (Anim BP)**

      - 캐릭터의 스켈레톤을 기반으로 애니메이션을 시각적으로 설계하는 데 특화된 블루프린트다.
      - **이벤트 그래프(Event Graph)**: 일반 블루프린트처럼 게임 로직과 연동하여 애니메이션에 필요한 변수들(예: 캐릭터 속도, 점프 여부)을 매 프레임 업데이트하는 역할을 한다.
      - **애님 그래프(Anim Graph)**: 이벤트 그래프에서 계산된 변수들을 사용하여, 어떤 애니메이션을 재생하고 어떻게 상태를 전환할지 시각적인 노드로 설계한다.

  - **스테이트 머신 (State Machine)**

      - 캐릭터의 여러 상태(예: Idle, Walk, Jump)와 그 상태들 사이의 전환(Transition) 조건을 정의하는 논리적 구조다.
      - **State(상태)**: 캐릭터의 현재 동작을 나타내며, 해당 상태에서 재생할 애니메이션을 담는다.
      - **Transition(전환)**: 한 상태에서 다른 상태로 넘어가는 조건. 예를 들어 '속도 \> 0'일 때 Idle 상태에서 Walk 상태로 전환된다.

<br/>

### 구현 과정

1.  **애니메이션 블루프린트 생성 및 적용**

    1.  콘텐츠 브라우저에서 `애니메이션 > 애니메이션 블루프린트`를 선택하여 생성한다. 이때 애니메이션을 적용할 스켈레톤(`SK_Mannequin`)을 지정한다.
    2.  생성한 AnimBP(`ABP_Sparta`)를 캐릭터 블루프린트(`BP_SpartaCharacter`)의 `Mesh` 컴포넌트의 `Anim Class`로 설정하여 연결한다.

2.  **이벤트 그래프에서 데이터 준비**

      - `Event BlueprintUpdateAnimation` 이벤트(매 프레임 호출됨)를 사용하여 애님 그래프에서 필요한 변수 값을 계속 갱신한다.

    1.  **캐릭터 참조 저장**: `Event BlueprintInitializeAnimation`에서 `Get Owning Actor`로 캐릭터 객체를 가져와 변수에 저장한다.
    2.  **수평 속도 (Ground Speed) 계산**: `Character Movement Component`의 `Get Velocity`를 호출하고 `Vector Length XY` 노드를 이용해 Z축을 제외한 수평 속도를 계산하여 `GroundSpeed` 변수에 저장한다.
    3.  **이동 여부 (Should Move) 계산**: `GroundSpeed`가 일정 값(예: 3.0)보다 큰지, 가속도가 있는지 등을 조합하여 실제 이동 중인지 판별하는 `ShouldMove` bool 변수를 만든다.
    4.  **낙하 여부 (Is Falling) 계산**: `Character Movement Component`의 `Is Falling` 함수 결과를 `IsFalling` bool 변수에 저장한다.

3.  **애님 그래프에서 스테이트 머신 설계**

      - 캐릭터의 복잡한 상태를 관리하기 위해 두 개의 스테이트 머신을 계층적으로 설계했다.

    1.  **`Locomotion` 스테이트 머신 (기본 이동)**
          - `Idle` 상태와 `Walk/Run` 상태를 만든다.
          - `Idle` 상태에서는 Idle 애니메이션을 반복 재생한다.
          - `Walk/Run` 상태에서는 `GroundSpeed` 값을 입력으로 받는 `Blend Space`를 사용하여 걷기와 달리기 애니메이션을 자연스럽게 섞어준다.
          - 두 상태의 전환 조건(Transition Rule)은 `ShouldMove` 변수 값에 따라 결정된다.
    2.  **`Main States` 스테이트 머신 (전체 상태)**
          - `Locomotion` 스테이트 머신을 `캐시된 포즈(Cached Pose)`로 저장하여 재사용 가능한 단일 노드로 만든다.
          - `Locomotion(캐시된 포즈)`, `Jump`, `Fall Loop`, `Land` 상태들을 포함하는 더 큰 스테이트 머신을 설계한다.
          - **스테이트 별칭(State Alias)** 기능을 사용해 여러 상태를 그룹으로 묶어 전환 로직을 단순화한다.
              - `To Falling` 그룹 (지상 → 공중): `Locomotion`, `Land` 상태에서 `IsFalling`이 `true`가 되면 `Jump` 또는 `Fall Loop`로 전환된다.
              - `To Land` 그룹 (공중 → 지상): `Jump`, `Fall Loop` 상태에서 `IsFalling`이 `false`가 되면 `Land` 상태로 전환된다.

<br/>

## 느낀점

  - 스테이트 머신은 캐릭터의 복잡한 애니메이션 로직을 매우 직관적이고 시각적으로 관리할 수 있게 해주는 강력한 도구다. 각 상태와 전환 조건이 명확하게 보여서 흐름을 파악하기 쉽다.
  - 이벤트 그래프에서 필요한 데이터를 계산하고, 애님 그래프에서는 그 데이터를 사용해 상태를 제어하는 역할 분담 구조가 인상적이다. 덕분에 로직이 깔끔하게 정리된다.
  - 특히 `캐시된 포즈`나 `스테이트 별칭` 같은 기능은 스테이트 머신이 복잡해졌을 때 확장성과 유지보수성을 크게 높여준다. 단순히 노드를 연결하는 것을 넘어, 잘 설계된 구조를 만드는 것이 얼마나 중요한지 깨달았다.

-----

### 요약

캐릭터 애니메이션은 **애니메이션 블루프린트**를 통해 구현한다. **이벤트 그래프**에서 캐릭터의 속도나 점프 상태 같은 변수들을 매 프레임 계산하고, **애님 그래프**의 **스테이트 머신**에서 이 변수들을 사용하여 `Idle`, `Walk`, `Jump`, `Fall` 등 각 상태에 맞는 애니메이션을 재생하고 상태를 전환한다. 스테이트 머신을 계층적으로 설계하고 `캐시된 포즈`, `스테이트 별칭` 같은 기능을 활용하면 복잡한 애니메이션 로직도 체계적으로 관리할 수 있다.
